# NETWORK & INFRASTRUCTURE DIAGRAM

## Physical/VM Layer

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              LOCAL MACHINE / VM                                 │
│                           (macOS / Linux / Windows)                             │
│                                                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────┐ │
│  │                              MINIKUBE VM                                   │ │
│  │                         (Docker Driver / VirtualBox)                       │ │
│  │                              IP: 192.168.49.2                              │ │
│  │                                                                            │ │
│  │  ┌──────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                      KUBERNETES CLUSTER                               │ │ │
│  │  │                                                                       │ │ │
│  │  │  ┌─────────────────────────────────────────────────────────────────┐ │ │ │
│  │  │  │                    NAMESPACE: mlops                              │ │ │ │
│  │  │  │                                                                  │ │ │ │
│  │  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │ │ │ │
│  │  │  │  │   MLflow    │  │   ML API    │  │   ML API                │ │ │ │ │
│  │  │  │  │    Pod      │  │   Pod 1     │  │   Pod 2                 │ │ │ │ │
│  │  │  │  │ 10.244.0.5  │  │ 10.244.0.6  │  │ 10.244.0.7              │ │ │ │ │
│  │  │  │  │   :5000     │  │   :8000     │  │   :8000                 │ │ │ │ │
│  │  │  │  └──────┬──────┘  └──────┬──────┘  └───────────┬─────────────┘ │ │ │ │
│  │  │  │         │                └──────────┬──────────┘               │ │ │ │
│  │  │  │         │                           │                          │ │ │ │
│  │  │  │  ┌──────▼──────┐             ┌──────▼──────┐                   │ │ │ │
│  │  │  │  │ClusterIP Svc│             │ClusterIP Svc│                   │ │ │ │
│  │  │  │  │   mlflow    │             │   ml-api    │                   │ │ │ │
│  │  │  │  │ 10.96.0.10  │             │ 10.96.0.11  │                   │ │ │ │
│  │  │  │  │   :5000     │             │   :8000     │                   │ │ │ │
│  │  │  │  └─────────────┘             └─────────────┘                   │ │ │ │
│  │  │  │                                                                 │ │ │ │
│  │  │  │  ┌─────────────────────────────────────────────────────────┐   │ │ │ │
│  │  │  │  │                    PVC: mlflow-data                      │   │ │ │ │
│  │  │  │  │                    5Gi - ReadWriteOnce                   │   │ │ │ │
│  │  │  │  └─────────────────────────────────────────────────────────┘   │ │ │ │
│  │  │  └─────────────────────────────────────────────────────────────────┘ │ │ │
│  │  │                                                                       │ │ │
│  │  │  ┌─────────────────────────────────────────────────────────────────┐ │ │ │
│  │  │  │                    NAMESPACE: kubeflow                          │ │ │ │
│  │  │  │                                                                  │ │ │ │
│  │  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │ │ │ │
│  │  │  │  │ ml-pipeline │  │ml-pipeline- │  │    workflow-            │ │ │ │ │
│  │  │  │  │   Pod       │  │  ui Pod     │  │    controller           │ │ │ │ │
│  │  │  │  │ 10.244.0.20 │  │ 10.244.0.21 │  │    10.244.0.22          │ │ │ │ │
│  │  │  │  └─────────────┘  └──────┬──────┘  └─────────────────────────┘ │ │ │ │
│  │  │  │                          │                                      │ │ │ │
│  │  │  │                   ┌──────▼──────┐                               │ │ │ │
│  │  │  │                   │ClusterIP Svc│                               │ │ │ │
│  │  │  │                   │ml-pipeline- │                               │ │ │ │
│  │  │  │                   │     ui      │                               │ │ │ │
│  │  │  │                   │   :80       │                               │ │ │ │
│  │  │  │                   └─────────────┘                               │ │ │ │
│  │  │  └─────────────────────────────────────────────────────────────────┘ │ │ │
│  │  │                                                                       │ │ │
│  │  └───────────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                            │ │
│  │  ┌──────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                        NODEPORT SERVICES                              │ │ │
│  │  │                     (Exposed to Host Machine)                         │ │ │
│  │  │                                                                       │ │ │
│  │  │    ┌─────────────────┐              ┌─────────────────┐              │ │ │
│  │  │    │ mlflow-external │              │    ml-api       │              │ │ │
│  │  │    │  NodePort:30500 │              │  NodePort:30080 │              │ │ │
│  │  │    └────────┬────────┘              └────────┬────────┘              │ │ │
│  │  │             │                                │                       │ │ │
│  │  └─────────────┼────────────────────────────────┼───────────────────────┘ │ │
│  │                │                                │                         │ │
│  └────────────────┼────────────────────────────────┼─────────────────────────┘ │
│                   │                                │                           │
│  ┌────────────────▼────────────────────────────────▼─────────────────────────┐ │
│  │                         HOST NETWORK INTERFACE                            │ │
│  │                                                                           │ │
│  │   http://192.168.49.2:30500  ──────────▶  MLflow UI                      │ │
│  │   http://192.168.49.2:30080  ──────────▶  ML API                         │ │
│  │   http://localhost:8080      ──────────▶  Kubeflow UI (port-forward)     │ │
│  │                                                                           │ │
│  └───────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```


## Network Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              NETWORK FLOW                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  EXTERNAL                           MINIKUBE                    INTERNAL        │
│  ────────                           ────────                    ────────        │
│                                                                                 │
│  ┌──────────┐                                                                   │
│  │ Browser  │                                                                   │
│  │ /Client  │                                                                   │
│  └────┬─────┘                                                                   │
│       │                                                                         │
│       │ :30500                      ┌─────────────────────────────────────────┐ │
│       ├────────────────────────────▶│  MLflow Service (NodePort)              │ │
│       │                             │  192.168.49.2:30500 → mlflow:5000       │ │
│       │                             └──────────────┬──────────────────────────┘ │
│       │                                            │                            │
│       │                                            ▼                            │
│       │                             ┌─────────────────────────────────────────┐ │
│       │                             │  MLflow Pod                              │ │
│       │                             │  - Tracking Server                       │ │
│       │                             │  - Model Registry                        │ │
│       │                             │  - Artifact Store (PVC)                  │ │
│       │                             └─────────────────────────────────────────┘ │
│       │                                                                         │
│       │ :30080                      ┌─────────────────────────────────────────┐ │
│       ├────────────────────────────▶│  ML API Service (NodePort)              │ │
│       │                             │  192.168.49.2:30080 → ml-api:8000       │ │
│       │                             └──────────────┬──────────────────────────┘ │
│       │                                            │                            │
│       │                                            ▼                            │
│       │                             ┌─────────────────────────────────────────┐ │
│       │                             │  ML API Pods (x2)                        │ │
│       │                             │  - /predict                              │ │
│       │                             │  - /drift/status                         │ │
│       │                             │  - /metrics                              │ │
│       │                             └──────────────┬──────────────────────────┘ │
│       │                                            │                            │
│       │                                            │ Internal DNS               │
│       │                                            │ mlflow.mlops.svc:5000      │
│       │                                            ▼                            │
│       │                             ┌─────────────────────────────────────────┐ │
│       │                             │  MLflow (ClusterIP)                      │ │
│       │                             │  - Load model from registry              │ │
│       │                             │  - Log predictions                       │ │
│       │                             └─────────────────────────────────────────┘ │
│       │                                                                         │
│       │ :8080 (port-forward)        ┌─────────────────────────────────────────┐ │
│       └────────────────────────────▶│  Kubeflow UI                             │ │
│                                     │  localhost:8080 → ml-pipeline-ui:80     │ │
│                                     └─────────────────────────────────────────┘ │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Service Communication Matrix

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         SERVICE COMMUNICATION MATRIX                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  FROM              TO                  PORT      PROTOCOL    PURPOSE            │
│  ────              ──                  ────      ────────    ───────            │
│                                                                                 │
│  Browser        → MLflow NodePort      30500     HTTP        UI Access          │
│  Browser        → ML API NodePort      30080     HTTP        API Access         │
│  Browser        → Kubeflow (fwd)       8080      HTTP        Pipeline UI        │
│                                                                                 │
│  ML API Pod     → MLflow ClusterIP     5000      HTTP        Load Model         │
│  ML API Pod     → MLflow ClusterIP     5000      HTTP        Log Metrics        │
│                                                                                 │
│  Kubeflow       → MLflow ClusterIP     5000      HTTP        Register Model     │
│  Kubeflow       → ML API ClusterIP     8000      HTTP        Trigger Deploy     │
│                                                                                 │
│  Pipeline Pod   → MLflow ClusterIP     5000      HTTP        Train & Log        │
│  Pipeline Pod   → K8s API              443       HTTPS       Deploy Update      │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Port Summary

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              PORT SUMMARY                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  SERVICE              TYPE          INTERNAL PORT    EXTERNAL PORT    ACCESS    │
│  ───────              ────          ─────────────    ─────────────    ──────    │
│                                                                                 │
│  mlflow               ClusterIP     5000             -                Internal  │
│  mlflow-external      NodePort      5000             30500            External  │
│                                                                                 │
│  ml-api               ClusterIP     8000             -                Internal  │
│  ml-api (NodePort)    NodePort      8000             30080            External  │
│                                                                                 │
│  ml-pipeline-ui       ClusterIP     80               -                Internal  │
│  (port-forward)       -             80               8080             External  │
│                                                                                 │
│  kubernetes           ClusterIP     443              -                Internal  │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```


## Complete Infrastructure View

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    DEVELOPER MACHINE                                    │
│                                   (macOS/Linux/Windows)                                 │
│                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│  │                                   DOCKER ENGINE                                  │   │
│  │                                                                                  │   │
│  │  ┌────────────────────────────────────────────────────────────────────────────┐ │   │
│  │  │                              MINIKUBE VM                                    │ │   │
│  │  │                           CPU: 2 | RAM: 4GB                                 │ │   │
│  │  │                          IP: 192.168.49.2                                   │ │   │
│  │  │                                                                             │ │   │
│  │  │  ┌───────────────────────────────────────────────────────────────────────┐ │ │   │
│  │  │  │                        KUBERNETES v1.28+                               │ │ │   │
│  │  │  │                                                                        │ │ │   │
│  │  │  │   ┌─────────────────────────────────────────────────────────────────┐ │ │ │   │
│  │  │  │   │                     NAMESPACE: kube-system                       │ │ │ │   │
│  │  │  │   │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────────────┐│ │ │ │   │
│  │  │  │   │  │coredns   │ │etcd      │ │kube-proxy│ │storage-provisioner   ││ │ │ │   │
│  │  │  │   │  └──────────┘ └──────────┘ └──────────┘ └──────────────────────┘│ │ │ │   │
│  │  │  │   └─────────────────────────────────────────────────────────────────┘ │ │ │   │
│  │  │  │                                                                        │ │ │   │
│  │  │  │   ┌─────────────────────────────────────────────────────────────────┐ │ │ │   │
│  │  │  │   │                     NAMESPACE: mlops                             │ │ │ │   │
│  │  │  │   │                                                                  │ │ │ │   │
│  │  │  │   │   ┌─────────────────────┐    ┌─────────────────────────────────┐│ │ │ │   │
│  │  │  │   │   │      MLFLOW         │    │           ML API                ││ │ │ │   │
│  │  │  │   │   │   ┌───────────┐     │    │  ┌───────────┐ ┌───────────┐   ││ │ │ │   │
│  │  │  │   │   │   │   Pod     │     │    │  │  Pod 1    │ │  Pod 2    │   ││ │ │ │   │
│  │  │  │   │   │   │ 256Mi/1Gi │     │    │  │ 256Mi/512M│ │ 256Mi/512M│   ││ │ │ │   │
│  │  │  │   │   │   └─────┬─────┘     │    │  └─────┬─────┘ └─────┬─────┘   ││ │ │ │   │
│  │  │  │   │   │         │           │    │        └──────┬──────┘         ││ │ │ │   │
│  │  │  │   │   │   ┌─────▼─────┐     │    │         ┌─────▼─────┐          ││ │ │ │   │
│  │  │  │   │   │   │  Service  │     │    │         │  Service  │          ││ │ │ │   │
│  │  │  │   │   │   │ClusterIP  │     │    │         │ NodePort  │          ││ │ │ │   │
│  │  │  │   │   │   │  :5000    │     │    │         │  :30080   │          ││ │ │ │   │
│  │  │  │   │   │   └───────────┘     │    │         └───────────┘          ││ │ │ │   │
│  │  │  │   │   │         │           │    │                                 ││ │ │ │   │
│  │  │  │   │   │   ┌─────▼─────┐     │    └─────────────────────────────────┘│ │ │ │   │
│  │  │  │   │   │   │  Service  │     │                                       │ │ │ │   │
│  │  │  │   │   │   │ NodePort  │     │                                       │ │ │ │   │
│  │  │  │   │   │   │  :30500   │     │                                       │ │ │ │   │
│  │  │  │   │   │   └───────────┘     │                                       │ │ │ │   │
│  │  │  │   │   │         │           │                                       │ │ │ │   │
│  │  │  │   │   │   ┌─────▼─────┐     │                                       │ │ │ │   │
│  │  │  │   │   │   │    PVC    │     │                                       │ │ │ │   │
│  │  │  │   │   │   │   5Gi     │     │                                       │ │ │ │   │
│  │  │  │   │   │   └───────────┘     │                                       │ │ │ │   │
│  │  │  │   │   └─────────────────────┘                                       │ │ │ │   │
│  │  │  │   └─────────────────────────────────────────────────────────────────┘ │ │ │   │
│  │  │  │                                                                        │ │ │   │
│  │  │  │   ┌─────────────────────────────────────────────────────────────────┐ │ │ │   │
│  │  │  │   │                     NAMESPACE: kubeflow                          │ │ │ │   │
│  │  │  │   │                                                                  │ │ │ │   │
│  │  │  │   │   ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────────┐   │ │ │ │   │
│  │  │  │   │   │ml-pipeline│ │ml-pipeline│ │ workflow- │ │   minio       │   │ │ │ │   │
│  │  │  │   │   │           │ │    -ui    │ │controller │ │  (artifacts)  │   │ │ │ │   │
│  │  │  │   │   └───────────┘ └───────────┘ └───────────┘ └───────────────┘   │ │ │ │   │
│  │  │  │   │                                                                  │ │ │ │   │
│  │  │  │   └─────────────────────────────────────────────────────────────────┘ │ │ │   │
│  │  │  │                                                                        │ │ │   │
│  │  │  └────────────────────────────────────────────────────────────────────────┘ │ │   │
│  │  │                                                                             │ │   │
│  │  └─────────────────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                                  │   │
│  └──────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                         │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐  │
│  │                              LOCAL DEVELOPMENT                                    │  │
│  │                                                                                   │  │
│  │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │  │
│  │   │   Python    │  │   kubectl   │  │   Docker    │  │      Browser            │ │  │
│  │   │   3.9+      │  │   CLI       │  │   CLI       │  │                         │ │  │
│  │   │             │  │             │  │             │  │  MLflow:  :30500        │ │  │
│  │   │ • train.py  │  │ • deploy    │  │ • build     │  │  API:     :30080        │ │  │
│  │   │ • trigger.py│  │ • logs      │  │ • push      │  │  Kubeflow::8080         │ │  │
│  │   └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────────┘ │  │
│  │                                                                                   │  │
│  └───────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

## Resource Requirements

**Host Machine: 16GB RAM** ✅ Đủ dùng!

| Component | Memory | CPU | Notes |
|-----------|--------|-----|-------|
| Minikube VM | 4GB | 2 cores | Có thể giảm xuống 3GB |
| MLflow | 256MB-512MB | 0.25 | Lightweight |
| ML API (1 pod) | 256MB-512MB | 0.25 | Giảm từ 2 pods xuống 1 |
| Kubeflow | ~2GB | 1 | Nặng nhất |
| **Total K8s** | **~4-5GB** | **~2** | |
| Host OS + Apps | ~4GB | - | |
| **Free** | **~7GB** | - | Buffer |

### Optimized Minikube Config

```bash
# Start minikube với config tối ưu cho 16GB host
minikube start \
  --memory=4096 \
  --cpus=2 \
  --disk-size=20g
```

### Nếu muốn tiết kiệm hơn (không cần Kubeflow)

```bash
# Chỉ chạy MLflow + API (không Kubeflow)
minikube start \
  --memory=3072 \
  --cpus=2

# Retrain bằng script thay vì Kubeflow pipeline
```

## Commands to Get IPs

```bash
# Get minikube IP
minikube ip

# Get all service endpoints
minikube service list

# Port forward for Kubeflow
kubectl port-forward -n kubeflow svc/ml-pipeline-ui 8080:80
```


## Access URLs

| Service | URL | Method |
|---------|-----|--------|
| MLflow UI | `http://$(minikube ip):30500` | NodePort |
| ML API | `http://$(minikube ip):30080` | NodePort |
| Kubeflow UI | `http://localhost:8080` | Port-forward |

## Commands to Get IPs

```bash
# Get minikube IP
minikube ip

# Get all service endpoints
minikube service list

# Port forward for Kubeflow
kubectl port-forward -n kubeflow svc/ml-pipeline-ui 8080:80
```
